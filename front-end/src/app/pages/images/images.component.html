<div class="gallery-container mat-elevation-z2">

  <!-- Header -->
  <div class="gallery-header">
    <h2><mat-icon>photo_library</mat-icon> Galeria</h2>
    <button mat-raised-button color="primary" (click)="fileInput.click()">
      <mat-icon>cloud_upload</mat-icon>
      Enviar Foto
    </button>
    <input type="file" #fileInput hidden (change)="onFileSelected($event)" />
  </div>

  <!-- Barra de progresso -->
 <div *ngIf="uploading" class="upload-progress">
  <mat-progress-bar mode="determinate" [value]="progress"></mat-progress-bar>
  <span class="progress-label">{{ progress }}%</span>
</div>

  <!-- Navegação (breadcrumb) -->
  <div class="breadcrumb" *ngIf="selectedYear || selectedMonth">
    <span class="breadcrumb-link" (click)="backToYears()">Anos</span>
    <span *ngIf="selectedYear"> /
      <span class="breadcrumb-link" (click)="backToMonths()">{{ selectedYear }}</span>
    </span>
    <span *ngIf="selectedMonth"> / {{ monthNames[selectedMonth - 1] }}</span>
  </div>

  <!-- Lista de anos -->
  <div class="folders" *ngIf="!selectedYear">
    <div class="folder" *ngFor="let year of years" (click)="openYear(year)">
      <mat-icon>folder</mat-icon>
      <span>{{ year }}</span>
    </div>
  </div>

  <!-- Lista de meses -->
  <div class="folders" *ngIf="selectedYear && !selectedMonth">
    <div class="folder" *ngFor="let month of months" (click)="openMonth(month)">
      <mat-icon>folder</mat-icon>
      <span>{{ monthNames[month - 1] }}</span>
    </div>
  </div>

  <!-- Estado vazio -->
  <div class="empty-state" *ngIf="selectedYear && selectedMonth && photos.length === 0">
    <mat-icon>photo_library</mat-icon>
    <p>Nenhuma foto encontrada</p>
  </div>

  <!-- Grid de miniaturas -->
  <div class="gallery-grid" *ngIf="selectedYear && selectedMonth && photos.length > 0">
    <div class="gallery-item" *ngFor="let photo of photos; let i = index">
      <img *ngIf="photo.type === 'photo'" [src]="apiUrl + photo.url" [alt]="photo.filename" (click)="openPhoto(i)" />
      <video *ngIf="photo.type === 'video'" [src]="apiUrl + photo.url" muted (click)="openPhoto(i)"></video>
      <button class="delete-btn pull-right" mat-icon-button color="warn" aria-label="Excluir"
              (click)="$event.stopPropagation(); onDeletePhoto(i)">
        <mat-icon>delete</mat-icon>
      </button>
    </div>
  </div>
<!-- Fullscreen sem thumbnails -->
<p-galleria
  [value]="photos"
  [(visible)]="displayFullscreen"
  [activeIndex]="activeIndex"
  [fullScreen]="true"
  [circular]="true"
  [showItemNavigators]="true"
  [showThumbnails]="false"
  (onHide)="displayFullscreen = false">

<!--  <ng-template pTemplate="header">-->
<!--    <div style="display:flex;justify-content:flex-end;gap:8px;padding:8px;">-->
<!--      <button mat-raised-button color="warn" (click)="onDeletePhoto(activeIndex)">-->
<!--        <mat-icon>delete</mat-icon>-->
<!--        Excluir-->
<!--      </button>-->
<!--    </div>-->
<!--  </ng-template>-->

  <!-- Item -->
  <ng-template pTemplate="item" let-item>
    <ng-container *ngIf="item.type === 'photo'; else videoTpl">
      <img [src]="apiUrl + item.url" [alt]="item.filename"
           style="max-height: 85vh; width: auto; margin: auto; display: block;" />
    </ng-container>
    <ng-template #videoTpl>
      <video [src]="apiUrl + item.url" controls
             style="max-height: 85vh; width: auto; margin: auto; display: block;"></video>
    </ng-template>
  </ng-template>
</p-galleria>

</div>
